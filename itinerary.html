<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pathfind.r - Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <!-- PRINT/PDF -->
  
  <style>
    @media print {
   
      header, footer, button,
      .export-actions {
        display: none !important;
      }

      .trip-details form,
      .itinerary-section form {
        display: none !important;
      }

      .itinerary-row button {
        display: none !important;
      }
      #trip_preview,
      #trip_preview *,
      #itinerary_output,
      #itinerary_output * {
        color: #000 !important;
      }
    }
  </style>
</head>
  
<body>
  
    <header>
    <a href="index.html">
      <img src="logo.png" class="logo">
    </a>
    <h1>Pathfind.r</h1>
    <p>Plan trips together. Share clear schedules. Export to calendar.</p>
  </header>

  <main>
    
    <!-- Step 1-->
    
    <section class="trip-details">
      <h2>Trip Details</h2>
      <form>
        <label for="destination">Destination</label>
        <input type="text" id="destination" placeholder="e.g., Tucson">

        <label for="start-date">Start Date</label>
        <input type="date" id="start-date">
        
        <label for="end-date">End Date</label>
        <input type="date" id="end-date">
        
        <label for="notes">Notes</label>
        <input type="text" id="notes" placeholder="Add trip notes...">

        <button type="button" id="next_button">Next</button>
      </form>

  <!-- Live Preview-->
      
      <div id="trip_preview" class="preview-box">
        <h3>Trip Preview</h3>
        <p><strong>Destination:</strong> <span id="previewDestination">-</span> </p>
        <p><strong>Start:</strong> <span id="previewStart">-</span> </p>
        <p><strong>End:</strong> <span id="previewEnd">-</span> </p>
        <p><strong>Notes:</strong> <span id="previewNotes">-</span> </p>
      </div>
    </section>  

    <!-- Step 2 -->
    
    <section class="itinerary-section" style="display: none;">
      <h2>Daily Schedule</h2>
      <form>
        <label for="day">Day</label>
        <input type="text" id="day" placeholder="e.g., Day 1 â€“ Monday">

        <label for="day">Activity</label>
        <input type="text" id="activity" placeholder="e.g., Check In">

        <label for="day">Time</label>
        <input type="time" id="time">

        <button type="button" id="back_button">Back</button>
      </form>

      <div id="itinerary_output" class="preview-box">
        <h3>Itinerary Preview</h3>
        <div id="itinerary_list"></div>
      </div>  

      <div class="export-actions">
        <button type="button" id="print_button">Print / Save PDF</button>
        <button type="button" id="ics_button">Download Calendar Reminder (.ics)</button>
        <button type="button" id="clear_trip_button">Clear Trip</button>
      </div>
    </section>
    
  </main>

  <footer>
    <small>&copy; 2025 Pathfind.r by Levi Hood</small>
  </footer>
  
<!-- JS (underscores)-->

<script>
// get reference to buttons and sections
  const next_button = document.getElementById('next_button');
  const back_button = document.getElementById('back_button');
  const trip_section = document.querySelector('.trip-details');
  const itinerary_section = document.querySelector('.itinerary-section');

// print and ics buttons
  const print_button = document.getElementById('print_button');
  const ics_button = document.getElementById('ics_button');

// get reference to input fields
  const destination_input = document.getElementById('destination');
  const start_date_input = document.getElementById('start-date');
  const end_date_input = document.getElementById('end-date');
  const notes_input = document.getElementById('notes');

// get reference to preview fields
  const preview_destination = document.getElementById('previewDestination');
  const preview_start = document.getElementById('previewStart');
  const preview_end = document.getElementById('previewEnd');
  const preview_notes = document.getElementById('previewNotes');

// update preview box in real-time
  function update_preview() {
    preview_destination.textContent = destination_input.value || '-';
    preview_start.textContent = start_date_input.value || '-';
    preview_end.textContent = end_date_input.value || '-';
    preview_notes.textContent = notes_input.value || '-';
  }

// listen for input changes and update preview
  destination_input.addEventListener('input', update_preview);
  start_date_input.addEventListener('input', update_preview);
  end_date_input.addEventListener('input', update_preview);
  notes_input.addEventListener('input', update_preview);

// When Next is clicked (input values)    
  next_button.addEventListener('click', () => {
    const destination = document.getElementById('destination').value;
    const start_date = document.getElementById('start-date').value;
    const end_date = document.getElementById('end-date').value;
    const notes = document.getElementById('notes').value;

//print button response
  print_button.addEventListener('click', () => {
    window.print();
  });
// consolidate values into object    
    const trip_data = { destination, start_date, end_date, notes };

// save to local storage
    localStorage.setItem('trip_details', JSON.stringify(trip_data));

// switch views
    trip_section.style.display = 'none';
    itinerary_section.style.display = 'block';

    render_itinerary();
  });
  
// check for saved data in local storage
  window.addEventListener('load', () => {
    const saved_trip = localStorage.getItem('trip_details');
    if (saved_trip) {
      const { destination, start_date, end_date, notes } = JSON.parse(saved_trip);
      document.getElementById('destination').value = destination || '';
      document.getElementById('start-date').value = start_date || '';
      document.getElementById('end-date').value = end_date || '';
      document.getElementById('notes').value = notes || '';
    }
    update_preview();
    render_itinerary();
  });

// when back is clicked
  back_button.addEventListener('click', () => {
    itinerary_section.style.display = 'none';
    trip_section.style.display = 'block';
  });

  
// select inputs
  const day_input = document.getElementById('day');
  const activity_input = document.getElementById('activity');
  const time_input = document.getElementById('time');
  const itinerary_list = document.getElementById('itinerary_list');

// delete item
  itinerary_list.addEventListener("click", (event) => {
    if (event.target.matches(".delete-item")) {
      const index = Number(event.target.dataset.index);
      const items = load_itinerary();
      items.splice(index,1); //removes one activity
      save_itinerary(items);
      render_itinerary(); //update itin
    }

  });
  
// load existing itinerary
  function load_itinerary() {
    const stored = localStorage.getItem('itinerary_items');
    return stored ? JSON.parse(stored) : [];
  }

// save itinerary
  function save_itinerary(items) {
    localStorage.setItem('itinerary_items', JSON.stringify(items));
  }


// pull day number
  function get_day_number(str) {
    const m = str.match(/\d+/);
    if (m) {
      return +m[0];
    } else {
      return 999;
    }
  }

  
// render itinerary
function render_itinerary() {
  const items = load_itinerary();
  const itinerary_list = document.getElementById("itinerary_list");
// sort by day number, then by time
  items.sort((a, b) => {
    const dayA = get_day_number(a.day);
    const dayB = get_day_number(b.day);
  
    if (dayA !== dayB) {
      return dayA - dayB; // smaller day first
    }
  
    // if same day, sort by time
    if (a.time < b.time) return -1;
    if (a.time > b.time) return 1;
    return 0;
  });

      
  // clear list
  itinerary_list.innerHTML = "";

  if (items.length === 0) {
    itinerary_list.innerHTML = "<p>No activities added yet.</p>";
    return;
  }

    let lastDay = null;
  // for each item in items, run the function to create a paragraph of those items
    items.forEach((item, index) => {
       const dayLabel = item.day || "";

      // new day header if the day changed
      if (dayLabel !== lastDay) {
        const header = document.createElement("p");
        header.className = "itinerary-day-header";
        header.textContent = dayLabel;
        itinerary_list.appendChild(header);
        lastDay = dayLabel;
      }

      // row
      const row = document.createElement("div");
      row.className = "itinerary-row";
      // paragraph
      const p = document.createElement("p");
      p.className = "itinerary-activity";
      p.textContent = `${item.time} ( ${item.activity} )`;
      // delete button
      const delBtn = document.createElement("button");
      delBtn.type = "button";
      delBtn.className = "delete-item";
      delBtn.dataset.index = index;
      delBtn.textContent = "Delete";
      
      row.appendChild(p);
      row.appendChild(delBtn);
      itinerary_list.appendChild(row);
  });
}
// clear whole itinerary
function clear_itinerary() {
  localStorage.removeItem("itinerary"); // delete saved trip data
  render_itinerary(); // refresh the preview to show it's empty
}

// download ICS function
function download_ics() {
  const items = load_itinerary();

  if (!items || items.length === 0) {
    alert("No activities to export yet.");
    return;
  }

  // name trip for ICS
  let tripName = destination_input.value.trim();
  if (!tripName) {
    tripName = "Pathfind.r Trip";
  }

  //trip description
  let description = "";
  items.forEach((item, index) => {
    if (index > 0) {
      description += "\\n"; // newline for ICS
    }
    description += `${item.day} ${item.time} - ${item.activity}`;
  });

  //reformat time data for ICS
  const now = new Date();
  const later = new Date(now.getTime() + 60 * 60 * 1000);
  const dtstart = now.toISOString().replace(/[-:]/g, "").split(".")[0];
  const dtend = later.toISOString().replace(/[-:]/g, "").split(".")[0];
  const dtstamp = dtstart;

  // create ICS file text
  const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Pathfindr//EN
BEGIN:VEVENT
UID:${Date.now()}@pathfindr
DTSTAMP:${dtstamp}
DTSTART:${dtstart}
DTEND:${dtend}
SUMMARY:${tripName}
DESCRIPTION:${description}
END:VEVENT
END:VCALENDAR`;

  // download ICS
  const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "pathfindr-trip.ics";
  a.click();
  URL.revokeObjectURL(url);  

  // add new item
document.getElementById("back_button").insertAdjacentHTML(
  "beforebegin",
  `<button type="button" id="add_item">Add Activity</button>`
);

document.getElementById("clear_trip_button").addEventListener("click", () => {
  if (confirm("Are you sure you want to clear your entire trip?")) {
    clear_itinerary();
  }
});
  
const add_item_btn = document.getElementById("add_item");

add_item_btn.addEventListener("click", () => {
  const day = day_input.value.trim();
  const activity = activity_input.value.trim();
  const time = time_input.value;

  if (!day || !activity || !time) {
    alert("Please fill all fields.");
    return;
  }

  const items = load_itinerary();
  items.push({ day, activity, time });
  save_itinerary(items);

  // reset inputs
  activity_input.value = "";
  time_input.value = "";

  render_itinerary();
});
</script>
  
</body>
